-- Apocalypse Rising 2 ESP Script
-- Includes: Zombie ESP, Vehicle ESP, Container ESP with Empty/Full Detection

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")
local LocalPlayer = Players.LocalPlayer

-- Create ScreenGui
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "Apoc2ESP"
ScreenGui.ResetOnSpawn = false

pcall(function()
    ScreenGui.Parent = game:GetService("CoreGui")
end)

if not ScreenGui.Parent then
    ScreenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")
end

-- Main Frame
local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0, 300, 0, 350)
MainFrame.Position = UDim2.new(0.5, -150, 0.5, -175)
MainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
MainFrame.BorderSizePixel = 0
MainFrame.Active = true
MainFrame.Draggable = true
MainFrame.Parent = ScreenGui

local MainCorner = Instance.new("UICorner")
MainCorner.CornerRadius = UDim.new(0, 12)
MainCorner.Parent = MainFrame

local MainStroke = Instance.new("UIStroke")
MainStroke.Color = Color3.fromRGB(150, 0, 0)
MainStroke.Thickness = 2
MainStroke.Parent = MainFrame

-- Title Bar
local TitleBar = Instance.new("Frame")
TitleBar.Size = UDim2.new(1, 0, 0, 50)
TitleBar.BackgroundColor3 = Color3.fromRGB(150, 0, 0)
TitleBar.BorderSizePixel = 0
TitleBar.Parent = MainFrame

local TitleCorner = Instance.new("UICorner")
TitleCorner.CornerRadius = UDim.new(0, 12)
TitleCorner.Parent = TitleBar

local TitleFix = Instance.new("Frame")
TitleFix.Size = UDim2.new(1, 0, 0, 25)
TitleFix.Position = UDim2.new(0, 0, 1, -25)
TitleFix.BackgroundColor3 = Color3.fromRGB(150, 0, 0)
TitleFix.BorderSizePixel = 0
TitleFix.Parent = TitleBar

local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, -100, 1, 0)
Title.Position = UDim2.new(0, 15, 0, 0)
Title.BackgroundTransparency = 1
Title.Text = "üßü APOC 2 ESP+"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.Font = Enum.Font.GothamBold
Title.TextSize = 20
Title.TextXAlignment = Enum.TextXAlignment.Left
Title.Parent = TitleBar

-- Close Button
local CloseButton = Instance.new("TextButton")
CloseButton.Size = UDim2.new(0, 35, 0, 35)
CloseButton.Position = UDim2.new(1, -42, 0, 7.5)
CloseButton.BackgroundColor3 = Color3.fromRGB(200, 0, 0)
CloseButton.Text = "X"
CloseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseButton.Font = Enum.Font.GothamBold
CloseButton.TextSize = 18
CloseButton.Parent = TitleBar

local CloseCorner = Instance.new("UICorner")
CloseCorner.CornerRadius = UDim.new(0, 8)
CloseCorner.Parent = CloseButton

CloseButton.MouseButton1Click:Connect(function()
    ScreenGui:Destroy()
end)

-- Content Frame
local ContentFrame = Instance.new("Frame")
ContentFrame.Size = UDim2.new(1, -20, 1, -65)
ContentFrame.Position = UDim2.new(0, 10, 0, 60)
ContentFrame.BackgroundTransparency = 1
ContentFrame.Parent = MainFrame

-- ESP Storage
local zombieESPObjects = {}
local vehicleESPObjects = {}
local containerESPObjects = {}

-- Features
local features = {
    zombieESP = false,
    vehicleESP = false,
    containerESP = false,
    debugMode = false
}

-- Helper function to check if object is part of a player
local function isPartOfPlayer(obj)
    -- Check if it's an accessory or part of character
    if obj:IsA("Accessory") or obj:FindFirstAncestorOfClass("Accessory") then
        return true
    end
    
    -- Check if any ancestor is a player character
    local current = obj
    while current and current ~= Workspace do
        -- Check if it's a player character
        if Players:GetPlayerFromCharacter(current) then
            return true
        end
        -- Check if parent is named like player body parts
        local name = current.Name
        if name == "Head" or name == "Torso" or name == "UpperTorso" or 
           name == "LowerTorso" or name == "HumanoidRootPart" or
           name == "Left Arm" or name == "Right Arm" or 
           name == "Left Leg" or name == "Right Leg" or
           name == "LeftUpperArm" or name == "RightUpperArm" or
           name == "LeftLowerArm" or name == "RightLowerArm" or
           name == "LeftUpperLeg" or name == "RightUpperLeg" or
           name == "LeftLowerLeg" or name == "RightLowerLeg" or
           name == "LeftFoot" or name == "RightFoot" or
           name == "LeftHand" or name == "RightHand" then
            return true
        end
        current = current.Parent
    end
    
    -- Check if it has a Humanoid (likely a character)
    if obj:FindFirstChildOfClass("Humanoid") then
        return true
    end
    
    return false
end

-- Helper function to check if container has loot
local function checkContainerContents(container)
    local itemCount = 0
    local debugInfo = {}
    
    -- IMPORTANT: Check if we can interact with it (most loot containers have ClickDetector or ProximityPrompt)
    local hasInteraction = container:FindFirstChildOfClass("ClickDetector", true) or 
                          container:FindFirstChildOfClass("ProximityPrompt", true)
    
    -- Method 1: Check for common loot folder names
    local lootFolders = {
        "Items", "Loot", "Storage", "Contents", "Inventory", 
        "ItemStorage", "LootStorage", "Slots", "LootTable"
    }
    
    for _, folderName in pairs(lootFolders) do
        local folder = container:FindFirstChild(folderName, true)
        if folder then
            local children = folder:GetChildren()
            for _, child in pairs(children) do
                -- Make sure it's not just lighting or effects
                if not child:IsA("Light") and not child:IsA("Fire") and 
                   not child:IsA("Smoke") and not child:IsA("ParticleEmitter") then
                    itemCount = itemCount + 1
                end
            end
            if #children > 0 then
                table.insert(debugInfo, folderName .. ":" .. #children)
            end
        end
    end
    
    -- Method 2: Check for Value objects that store loot info
    for _, child in pairs(container:GetDescendants()) do
        if child:IsA("IntValue") or child:IsA("NumberValue") then
            local valueName = child.Name:lower()
            -- Look for specific loot-related value names
            if valueName == "loot" or valueName == "items" or 
               valueName == "itemcount" or valueName == "lootcount" or
               valueName == "count" then
                if child.Value > 0 then
                    itemCount = child.Value
                    table.insert(debugInfo, child.Name .. "=" .. child.Value)
                    if features.debugMode then
                        print("Found loot value: " .. child.Name .. " = " .. child.Value .. " in " .. container.Name)
                    end
                end
            end
        elseif child:IsA("BoolValue") then
            local valueName = child.Name:lower()
            if valueName == "hasloot" or valueName == "hasitems" or valueName == "full" then
                if child.Value then
                    return true, 1
                end
            elseif valueName == "empty" or valueName == "looted" or valueName == "isempty" then
                if child.Value then
                    return false, 0
                else
                    return true, 1 -- Not empty
                end
            end
        end
    end
    
    -- Method 3: Check for actual item models (Tools, parts with specific names)
    for _, child in pairs(container:GetDescendants()) do
        if child:IsA("Tool") then
            itemCount = itemCount + 1
            table.insert(debugInfo, "Tool:" .. child.Name)
        end
        
        -- Check for models that look like items
        if child:IsA("Model") then
            local name = child.Name:lower()
            if name:find("weapon") or name:find("gun") or name:find("rifle") or
               name:find("pistol") or name:find("ammo") or name:find("magazine") or
               name:find("medkit") or name:find("bandage") or name:find("food") or
               name:find("water") or name:find("soda") or name:find("backpack") or
               name:find("vest") or name:find("helmet") then
                -- Make sure it's not a spawn point or placeholder
                if not name:find("spawn") and not name:find("point") and not name:find("dummy") then
                    itemCount = itemCount + 1
                    table.insert(debugInfo, "Item:" .. child.Name)
                end
            end
        end
    end
    
    -- Debug output
    if features.debugMode and (#debugInfo > 0 or hasInteraction) then
        print("Container: " .. container.Name .. 
              " | Items: " .. itemCount .. 
              " | HasInteraction: " .. tostring(hasInteraction) .. 
              " | Details: " .. table.concat(debugInfo, ", "))
    end
    
    -- If no items detected but has interaction, assume it might have loot
    -- (Some games spawn loot dynamically when you open the container)
    if itemCount == 0 and hasInteraction then
        -- Default to showing as potentially having loot (yellow/neutral)
        return nil, 0 -- nil means "unknown" status
    end
    
    return itemCount > 0, itemCount
end

-- Button creator
local yPos = 0
local function createButton(text, callback)
    local Button = Instance.new("TextButton")
    Button.Size = UDim2.new(1, 0, 0, 50)
    Button.Position = UDim2.new(0, 0, 0, yPos)
    Button.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    Button.Text = text
    Button.TextColor3 = Color3.fromRGB(255, 255, 255)
    Button.Font = Enum.Font.Gotham
    Button.TextSize = 15
    Button.Parent = ContentFrame
    
    local ButtonCorner = Instance.new("UICorner")
    ButtonCorner.CornerRadius = UDim.new(0, 10)
    ButtonCorner.Parent = Button
    
    local ButtonStroke = Instance.new("UIStroke")
    ButtonStroke.Color = Color3.fromRGB(70, 70, 70)
    ButtonStroke.Thickness = 2
    ButtonStroke.Parent = Button
    
    Button.MouseButton1Click:Connect(function()
        callback(Button)
    end)
    
    yPos = yPos + 60
    return Button
end

-- Helper function to get character
local function getCharacter()
    return LocalPlayer.Character
end

-- Zombie ESP
createButton("üßü Zombie ESP: OFF", function(btn)
    features.zombieESP = not features.zombieESP
    if features.zombieESP then
        btn.Text = "üßü Zombie ESP: ON"
        btn.BackgroundColor3 = Color3.fromRGB(0, 180, 0)
        print("Zombie ESP enabled - scanning for zombies...")
        
        spawn(function()
            while features.zombieESP do
                local char = getCharacter()
                if not char then wait(1) continue end
                local rootPart = char:FindFirstChild("HumanoidRootPart")
                
                pcall(function()
                    -- Method 1: Check Workspace for zombie models
                    for _, obj in pairs(Workspace:GetChildren()) do
                        if obj:IsA("Model") and obj ~= char then
                            local name = obj.Name:lower()
                            local isPlayer = Players:GetPlayerFromCharacter(obj)
                            local hasHumanoid = obj:FindFirstChildOfClass("Humanoid")
                            
                            local isZombie = (hasHumanoid and not isPlayer) or name:find("zombie") or name:find("infected")
                            
                            if isZombie and not obj:FindFirstChild("ZombieESP_H") then
                                local highlight = Instance.new("Highlight")
                                highlight.Name = "ZombieESP_H"
                                highlight.FillColor = Color3.fromRGB(255, 100, 0)
                                highlight.OutlineColor = Color3.fromRGB(255, 0, 0)
                                highlight.FillTransparency = 0.5
                                highlight.OutlineTransparency = 0
                                highlight.Parent = obj
                                table.insert(zombieESPObjects, highlight)
                                
                                local head = obj:FindFirstChild("Head") or obj:FindFirstChild("HumanoidRootPart") or obj:FindFirstChildWhichIsA("BasePart")
                                if head and head:IsA("BasePart") then
                                    local billboard = Instance.new("BillboardGui")
                                    billboard.Name = "ZombieESP_L"
                                    billboard.Size = UDim2.new(0, 150, 0, 50)
                                    billboard.StudsOffset = Vector3.new(0, 3, 0)
                                    billboard.AlwaysOnTop = true
                                    billboard.Parent = head
                                    table.insert(zombieESPObjects, billboard)
                                    
                                    local label = Instance.new("TextLabel")
                                    label.Size = UDim2.new(1, 0, 1, 0)
                                    label.BackgroundTransparency = 0.3
                                    label.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
                                    label.Text = "üßü " .. obj.Name
                                    label.TextColor3 = Color3.fromRGB(255, 100, 0)
                                    label.TextScaled = true
                                    label.Font = Enum.Font.GothamBold
                                    label.Parent = billboard
                                    
                                    local corner = Instance.new("UICorner")
                                    corner.CornerRadius = UDim.new(0, 6)
                                    corner.Parent = label
                                end
                            end
                        end
                    end
                    
                    -- Method 2: Check for specific zombie folders
                    local zombieFolders = {
                        Workspace:FindFirstChild("Zombies"),
                        Workspace:FindFirstChild("NPCs"),
                        Workspace:FindFirstChild("Enemies"),
                        Workspace:FindFirstChild("AI")
                    }
                    
                    for _, folder in pairs(zombieFolders) do
                        if folder then
                            for _, zombie in pairs(folder:GetChildren()) do
                                if zombie:IsA("Model") and not zombie:FindFirstChild("ZombieESP_H") then
                                    local highlight = Instance.new("Highlight")
                                    highlight.Name = "ZombieESP_H"
                                    highlight.FillColor = Color3.fromRGB(255, 100, 0)
                                    highlight.OutlineColor = Color3.fromRGB(255, 0, 0)
                                    highlight.FillTransparency = 0.5
                                    highlight.OutlineTransparency = 0
                                    highlight.Parent = zombie
                                    table.insert(zombieESPObjects, highlight)
                                    
                                    local head = zombie:FindFirstChild("Head") or zombie:FindFirstChild("HumanoidRootPart")
                                    if head and head:IsA("BasePart") then
                                        local billboard = Instance.new("BillboardGui")
                                        billboard.Name = "ZombieESP_L"
                                        billboard.Size = UDim2.new(0, 150, 0, 50)
                                        billboard.StudsOffset = Vector3.new(0, 3, 0)
                                        billboard.AlwaysOnTop = true
                                        billboard.Parent = head
                                        table.insert(zombieESPObjects, billboard)
                                        
                                        local label = Instance.new("TextLabel")
                                        label.Size = UDim2.new(1, 0, 1, 0)
                                        label.BackgroundTransparency = 0.3
                                        label.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
                                        label.Text = "üßü " .. zombie.Name
                                        label.TextColor3 = Color3.fromRGB(255, 100, 0)
                                        label.TextScaled = true
                                        label.Font = Enum.Font.GothamBold
                                        label.Parent = billboard
                                        
                                        local corner = Instance.new("UICorner")
                                        corner.CornerRadius = UDim.new(0, 6)
                                        corner.Parent = label
                                    end
                                end
                            end
                        end
                    end
                end)
                wait(2)
            end
        end)
        
        -- Distance updater
        spawn(function()
            while features.zombieESP do
                local char = getCharacter()
                if not char then wait(1) continue end
                local rootPart = char:FindFirstChild("HumanoidRootPart")
                
                pcall(function()
                    for _, obj in pairs(zombieESPObjects) do
                        if obj and obj.Parent and obj.Name == "ZombieESP_L" then
                            local label = obj:FindFirstChildOfClass("TextLabel")
                            local parent = obj.Parent
                            if label and parent and parent:IsA("BasePart") and rootPart then
                                local dist = math.floor((parent.Position - rootPart.Position).Magnitude)
                                local modelName = parent.Parent and parent.Parent.Name or "Zombie"
                                label.Text = "üßü " .. modelName .. " [" .. dist .. "m]"
                            end
                        end
                    end
                end)
                wait(0.5)
            end
        end)
    else
        btn.Text = "üßü Zombie ESP: OFF"
        btn.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
        
        for _, obj in pairs(zombieESPObjects) do
            if obj and obj.Parent then obj:Destroy() end
        end
        zombieESPObjects = {}
        
        pcall(function()
            for _, obj in pairs(Workspace:GetDescendants()) do
                if obj.Name == "ZombieESP_H" or obj.Name == "ZombieESP_L" then
                    obj:Destroy()
                end
            end
        end)
    end
end)

-- Vehicle ESP
createButton("üöó Vehicle ESP: OFF", function(btn)
    features.vehicleESP = not features.vehicleESP
    if features.vehicleESP then
        btn.Text = "üöó Vehicle ESP: ON"
        btn.BackgroundColor3 = Color3.fromRGB(0, 180, 0)
        print("Vehicle ESP enabled - scanning for vehicles...")
        
        spawn(function()
            while features.vehicleESP do
                local char = getCharacter()
                if not char then wait(1) continue end
                
                pcall(function()
                    for _, obj in pairs(Workspace:GetDescendants()) do
                        if obj:IsA("VehicleSeat") and not obj:FindFirstChild("VehicleESP_L") then
                            local vehicle = obj.Parent
                            if vehicle and vehicle:IsA("Model") then
                                local vehicleName = vehicle.Name
                                if vehicleName == "Seats" or vehicleName == "Parts" then
                                    if vehicle.Parent and vehicle.Parent:IsA("Model") then
                                        vehicleName = vehicle.Parent.Name
                                    end
                                end
                                
                                if not vehicle:FindFirstChild("VehicleESP_H") then
                                    local highlight = Instance.new("Highlight")
                                    highlight.Name = "VehicleESP_H"
                                    highlight.FillColor = Color3.fromRGB(0, 255, 0)
                                    highlight.OutlineColor = Color3.fromRGB(255, 255, 255)
                                    highlight.FillTransparency = 0.5
                                    highlight.OutlineTransparency = 0
                                    highlight.Parent = vehicle
                                    table.insert(vehicleESPObjects, highlight)
                                end
                                
                                local billboard = Instance.new("BillboardGui")
                                billboard.Name = "VehicleESP_L"
                                billboard.Size = UDim2.new(0, 150, 0, 50)
                                billboard.StudsOffset = Vector3.new(0, 5, 0)
                                billboard.AlwaysOnTop = true
                                billboard.Parent = obj
                                table.insert(vehicleESPObjects, billboard)
                                
                                local label = Instance.new("TextLabel")
                                label.Size = UDim2.new(1, 0, 1, 0)
                                label.BackgroundTransparency = 0.3
                                label.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
                                label.Text = "üöó " .. vehicleName
                                label.TextColor3 = Color3.fromRGB(0, 255, 0)
                                label.TextScaled = true
                                label.Font = Enum.Font.GothamBold
                                label.Parent = billboard
                                
                                local corner = Instance.new("UICorner")
                                corner.CornerRadius = UDim.new(0, 6)
                                corner.Parent = label
                            end
                        end
                    end
                end)
                wait(3)
            end
        end)
        
        -- Distance updater
        spawn(function()
            while features.vehicleESP do
                local char = getCharacter()
                if not char then wait(1) continue end
                local rootPart = char:FindFirstChild("HumanoidRootPart")
                
                pcall(function()
                    for _, obj in pairs(vehicleESPObjects) do
                        if obj and obj.Parent and obj.Name == "VehicleESP_L" then
                            local label = obj:FindFirstChildOfClass("TextLabel")
                            local seat = obj.Parent
                            if label and seat and seat:IsA("BasePart") and rootPart then
                                local dist = math.floor((seat.Position - rootPart.Position).Magnitude)
                                local vehicle = seat.Parent
                                local vehicleName = vehicle and vehicle.Name or "Vehicle"
                                if vehicleName == "Seats" or vehicleName == "Parts" then
                                    if vehicle.Parent and vehicle.Parent:IsA("Model") then
                                        vehicleName = vehicle.Parent.Name
                                    end
                                end
                                label.Text = "üöó " .. vehicleName .. " [" .. dist .. "m]"
                            end
                        end
                    end
                end)
                wait(1)
            end
        end)
    else
        btn.Text = "üöó Vehicle ESP: OFF"
        btn.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
        
        for _, obj in pairs(vehicleESPObjects) do
            if obj and obj.Parent then obj:Destroy() end
        end
        vehicleESPObjects = {}
        
        pcall(function()
            for _, obj in pairs(Workspace:GetDescendants()) do
                if obj.Name == "VehicleESP_H" or obj.Name == "VehicleESP_L" then
                    obj:Destroy()
                end
            end
        end)
    end
end)

-- Container ESP with Empty/Full Detection
createButton("üì¶ Container ESP: OFF", function(btn)
    features.containerESP = not features.containerESP
    if features.containerESP then
        btn.Text = "üì¶ Container ESP: ON"
        btn.BackgroundColor3 = Color3.fromRGB(0, 180, 0)
        print("Container ESP enabled - scanning for containers...")
        
        spawn(function()
            while features.containerESP do
                local char = getCharacter()
                if not char then wait(1) continue end
                
                pcall(function()
                    for _, obj in pairs(Workspace:GetDescendants()) do
                        -- Only check Models (not individual Parts to reduce lag)
                        if not obj:IsA("Model") or obj:FindFirstChild("ContainerESP_L") then
                            continue
                        end
                        
                        local name = obj.Name:lower()
                        
                        -- EARLY EXCLUSIONS - Check these FIRST to improve performance
                        local isExcluded = name:find("hitbox") or name:find("collision") or 
                                          name:find("trigger") or name:find("zone") or
                                          name:find("effect") or name:find("particle") or
                                          name:find("sound") or name:find("light") or
                                          name:find("engine") or name:find("wheel") or
                                          name:find("seat") or name:find("window") or
                                          name:find("door") or name:find("handle") or
                                          name:find("attachment") or name:find("weld") or
                                          name:find("joint") or name:find("constraint") or
                                          name:find("spawn") or name:find("barrel")
                        
                        if isExcluded then
                            continue
                        end
                        
                        -- STRICT PLAYER CHECK - Skip anything related to players
                        if isPartOfPlayer(obj) then
                            continue
                        end
                        
                        -- Check for container keywords - MUST match at least one
                        local hasContainerKeyword = name:find("container") or name:find("crate") or 
                                                   name:find("tent") or name:find("military") or 
                                                   name:find("supply") or name:find("box") or 
                                                   name:find("chest") or name:find("locker") or
                                                   name:find("bag") or name:find("cache") or
                                                   name:find("stash") or name:find("storage")
                        
                        if hasContainerKeyword then
                                local targetPart = obj
                                if obj:IsA("Model") then
                                    targetPart = obj.PrimaryPart or obj:FindFirstChildWhichIsA("BasePart", true)
                                end
                                
                                if targetPart and targetPart:IsA("BasePart") then
                                    -- Check if container has loot
                                    local hasLoot, itemCount = checkContainerContents(obj)
                                    
                                    -- Determine colors based on loot status
                                    local fillColor, outlineColor, textColor, statusEmoji, statusText
                                    
                                    if hasLoot == nil then
                                        -- Unknown status (has interaction but no visible items)
                                        fillColor = Color3.fromRGB(255, 255, 0)
                                        outlineColor = Color3.fromRGB(255, 165, 0)
                                        textColor = Color3.fromRGB(255, 255, 0)
                                        statusEmoji = "‚ùì"
                                        statusText = "[UNKNOWN]"
                                    elseif hasLoot then
                                        -- Has loot
                                        fillColor = Color3.fromRGB(0, 255, 0)
                                        outlineColor = Color3.fromRGB(0, 200, 0)
                                        textColor = Color3.fromRGB(0, 255, 0)
                                        statusEmoji = "‚úÖ"
                                        statusText = itemCount > 0 and "[" .. itemCount .. " ITEMS]" or "[LOOT]"
                                    else
                                        -- Empty
                                        fillColor = Color3.fromRGB(255, 50, 50)
                                        outlineColor = Color3.fromRGB(200, 0, 0)
                                        textColor = Color3.fromRGB(255, 50, 50)
                                        statusEmoji = "‚ùå"
                                        statusText = "[EMPTY]"
                                    end
                                    
                                    -- Add highlight with color based on loot status
                                    if obj:IsA("Model") and not obj:FindFirstChild("ContainerESP_H") then
                                        local highlight = Instance.new("Highlight")
                                        highlight.Name = "ContainerESP_H"
                                        highlight.FillColor = fillColor
                                        highlight.OutlineColor = outlineColor
                                        highlight.FillTransparency = 0.5
                                        highlight.OutlineTransparency = 0
                                        highlight.Parent = obj
                                        table.insert(containerESPObjects, highlight)
                                    end
                                    
                                    -- Add label
                                    local billboard = Instance.new("BillboardGui")
                                    billboard.Name = "ContainerESP_L"
                                    billboard.Size = UDim2.new(0, 180, 0, 50)
                                    billboard.StudsOffset = Vector3.new(0, 3, 0)
                                    billboard.AlwaysOnTop = true
                                    billboard.Parent = targetPart
                                    table.insert(containerESPObjects, billboard)
                                    
                                    local label = Instance.new("TextLabel")
                                    label.Size = UDim2.new(1, 0, 1, 0)
                                    label.BackgroundTransparency = 0.3
                                    label.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
                                    
                                    local displayName = obj.Name
                                    displayName = displayName:gsub("LootGroup", "")
                                    displayName = displayName:gsub("Detail", "")
                                    displayName = displayName:gsub("Core", "")
                                    displayName = displayName:gsub("_", " ")
                                    displayName = displayName:gsub("^%s*(.-)%s*$", "%1")
                                    if displayName == "" then displayName = "Container" end
                                    
                                    label.Text = statusEmoji .. " " .. displayName .. " " .. statusText
                                    label.TextColor3 = textColor
                                    label.TextScaled = true
                                    label.Font = Enum.Font.GothamBold
                                    label.Parent = billboard
                                    
                                    local corner = Instance.new("UICorner")
                                    corner.CornerRadius = UDim.new(0, 6)
                                    corner.Parent = label
                                end
                            end
                        end
                    end
                end)
                wait(3)
            end
        end)
        
        -- Distance and loot status updater
        spawn(function()
            while features.containerESP do
                local char = getCharacter()
                if not char then wait(1) continue end
                local rootPart = char:FindFirstChild("HumanoidRootPart")
                
                pcall(function()
                    for _, obj in pairs(containerESPObjects) do
                        if obj and obj.Parent and obj.Name == "ContainerESP_L" then
                            local label = obj:FindFirstChildOfClass("TextLabel")
                            local parent = obj.Parent
                            if label and parent and parent:IsA("BasePart") and rootPart then
                                local dist = math.floor((parent.Position - rootPart.Position).Magnitude)
                                local containerObj = parent.Parent or parent
                                local containerName = containerObj.Name
                                
                                containerName = containerName:gsub("LootGroup", "")
                                containerName = containerName:gsub("Detail", "")
                                containerName = containerName:gsub("Core", "")
                                containerName = containerName:gsub("_", " ")
                                containerName = containerName:gsub("^%s*(.-)%s*$", "%1")
                                if containerName == "" then containerName = "Container" end
                                
                                -- Re-check loot status
                                local hasLoot, itemCount = checkContainerContents(containerObj)
                                
                                local statusEmoji, statusText, textColor, fillColor, outlineColor
                                
                                if hasLoot == nil then
                                    statusEmoji = "‚ùì"
                                    statusText = "[UNKNOWN]"
                                    textColor = Color3.fromRGB(255, 255, 0)
                                    fillColor = Color3.fromRGB(255, 255, 0)
                                    outlineColor = Color3.fromRGB(255, 165, 0)
                                elseif hasLoot then
                                    statusEmoji = "‚úÖ"
                                    statusText = itemCount > 0 and "[" .. itemCount .. " ITEMS]" or "[LOOT]"
                                    textColor = Color3.fromRGB(0, 255, 0)
                                    fillColor = Color3.fromRGB(0, 255, 0)
                                    outlineColor = Color3.fromRGB(0, 200, 0)
                                else
                                    statusEmoji = "‚ùå"
                                    statusText = "[EMPTY]"
                                    textColor = Color3.fromRGB(255, 50, 50)
                                    fillColor = Color3.fromRGB(255, 50, 50)
                                    outlineColor = Color3.fromRGB(200, 0, 0)
                                end
                                
                                label.Text = statusEmoji .. " " .. containerName .. " " .. statusText .. " [" .. dist .. "m]"
                                label.TextColor3 = textColor
                                
                                -- Update highlight color if it exists
                                local highlight = containerObj:FindFirstChild("ContainerESP_H")
                                if highlight then
                                    highlight.FillColor = fillColor
                                    highlight.OutlineColor = outlineColor
                                end
                            end
                        end
                    end
                end)
                wait(1)
            end
        end)
    else
        btn.Text = "üì¶ Container ESP: OFF"
        btn.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
        
        for _, obj in pairs(containerESPObjects) do
            if obj and obj.Parent then obj:Destroy() end
        end
        containerESPObjects = {}
        
        pcall(function()
            for _, obj in pairs(Workspace:GetDescendants()) do
                if obj.Name == "ContainerESP_H" or obj.Name == "ContainerESP_L" then
                    obj:Destroy()
                end
            end
        end)
    end
end)

-- Clear All ESP Button
createButton("üóëÔ∏è Clear All ESP", function(btn)
    for _, obj in pairs(zombieESPObjects) do
        if obj and obj.Parent then obj:Destroy() end
    end
    for _, obj in pairs(vehicleESPObjects) do
        if obj and obj.Parent then obj:Destroy() end
    end
    for _, obj in pairs(containerESPObjects) do
        if obj and obj.Parent then obj:Destroy() end
    end
    
    zombieESPObjects = {}
    vehicleESPObjects = {}
    containerESPObjects = {}
    
    pcall(function()
        for _, obj in pairs(Workspace:GetDescendants()) do
            if obj.Name:find("ESP_") then
                obj:Destroy()
            end
        end
    end)
    
    btn.BackgroundColor3 = Color3.fromRGB(0, 180, 0)
    wait(0.5)
    btn.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
end)

-- Debug Mode Button
createButton("üîç Debug Mode: OFF", function(btn)
    features.debugMode = not features.debugMode
    if features.debugMode then
        btn.Text = "üîç Debug Mode: ON"
        btn.BackgroundColor3 = Color3.fromRGB(0, 180, 0)
        print("=== DEBUG MODE ENABLED ===")
        print("Click on containers in-game to see their structure")
        
        -- Print all container structures found
        spawn(function()
            wait(1)
            print("\n=== SCANNING FOR CONTAINERS ===")
            for _, obj in pairs(Workspace:GetDescendants()) do
                if obj:IsA("Model") or obj:IsA("Part") then
                    local name = obj.Name:lower()
                    if name:find("container") or name:find("crate") or 
                       name:find("tent") or name:find("military") or 
                       name:find("supply") or name:find("box") or 
                       name:find("chest") or name:find("locker") then
                        print("\n--- Container Found: " .. obj.Name .. " ---")
                        print("Type: " .. obj.ClassName)
                        print("Children (" .. #obj:GetChildren() .. "):")
                        for i, child in pairs(obj:GetChildren()) do
                            if i <= 10 then -- Limit output
                                print("  - " .. child.Name .. " (" .. child.ClassName .. ")")
                            end
                        end
                        
                        -- Check for value objects
                        print("Value Objects:")
                        for _, desc in pairs(obj:GetDescendants()) do
                            if desc:IsA("IntValue") or desc:IsA("BoolValue") or 
                               desc:IsA("StringValue") or desc:IsA("NumberValue") then
                                local value = tostring(desc.Value)
                                print("  - " .. desc.Name .. " (" .. desc.ClassName .. ") = " .. value)
                            end
                        end
                    end
                end
            end
            print("\n=== SCAN COMPLETE ===\n")
        end)
    else
        btn.Text = "üîç Debug Mode: OFF"
        btn.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
        print("=== DEBUG MODE DISABLED ===")
    end
end)

print("‚úì Apocalypse Rising 2 ESP+ Loaded!")
print("üßü Zombie ESP - Shows zombies with names and distance")
print("üöó Vehicle ESP - Shows vehicles with names and distance")
print("üì¶ Container ESP - Shows containers with loot status and distance")
print("‚úÖ Green = Has Loot | ‚ùå Red = Empty | ‚ùì Yellow = Unknown")
print("üîç Use Debug Mode to see container structure in console (F9)")
print("Note: Yellow/Unknown means the container has interaction but loot status cannot be determined")